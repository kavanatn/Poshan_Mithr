{% extends "base.html" %} {% block title %}Headmaster Dashboard - Nutrition
Management{% endblock %} {% block content %}
<div class="container-fluid">
  <div class="row mb-4">
    <div class="col-12">
      <h2>🏫 Headmaster Dashboard</h2>
      <p class="text-muted">Manage students and monitor school nutrition</p>
    </div>
  </div>

  <!-- Quick Stats Cards -->
  <div class="row mb-4">
    <div class="col-lg-3 col-md-6 mb-3">
      <div class="card bg-primary text-white h-100">
        <div class="card-body text-center">
          <h2 class="mb-0">{{ classrooms | length }}</h2>
          <p class="mb-0">🏛️ Total Classrooms</p>
        </div>
      </div>
    </div>

    <div class="col-lg-3 col-md-6 mb-3">
      <div class="card bg-success text-white h-100">
        <div class="card-body text-center">
          <h2 class="mb-0">{{ total_kids }}</h2>
          <p class="mb-0">👨‍🎓 Total Students</p>
        </div>
      </div>
    </div>

    <div class="col-lg-3 col-md-6 mb-3">
      <div class="card bg-info text-white h-100">
        <div class="card-body text-center">
          <h2 class="mb-0">
            {{ (total_kids / (classrooms | length)) | round(1) if classrooms
            else 0 }}
          </h2>
          <p class="mb-0">📊 Avg Students/Class</p>
        </div>
      </div>
    </div>

    <div class="col-lg-3 col-md-6 mb-3">
      <div class="card bg-warning text-white h-100">
        <div class="card-body text-center">
          <h2 class="mb-0">{{ assessed_kids }}</h2>
          <p class="mb-0">✅ Assessed Students</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Quick Actions -->
  <div class="row mb-4">
    <div class="col-12">
      <div class="card">
        <div class="card-header bg-primary text-white">
          <h5 class="mb-0">⚡ Quick Actions</h5>
        </div>
        <div class="card-body">
          <div class="row">
            <div class="col-md-4 mb-3">
              <a
                href="/authority/create-classroom"
                class="btn btn-success w-100 btn-lg"
              >
                <div class="d-flex flex-column align-items-center">
                  <span style="font-size: 2rem">🏛️</span>
                  <span class="mt-2">Create Classroom</span>
                </div>
              </a>
            </div>
            <div class="col-md-4 mb-3">
              <a
                href="/authority/create-kid"
                class="btn btn-primary w-100 btn-lg"
              >
                <div class="d-flex flex-column align-items-center">
                  <span style="font-size: 2rem">👶</span>
                  <span class="mt-2">Add New Student</span>
                </div>
              </a>
            </div>
            <div class="col-md-4 mb-3">
              <a
                href="/authority/nutrition-calculator"
                class="btn btn-warning w-100 btn-lg"
              >
                <div class="d-flex flex-column align-items-center">
                  <span style="font-size: 2rem">🧮</span>
                  <span class="mt-2">Nutrition Calculator</span>
                </div>
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Classroom Details -->
  <div class="row">
    <div class="col-12">
      <div class="card">
        <div class="card-header bg-success text-white">
          <h5 class="mb-0">🏛️ Classroom Details</h5>
        </div>
        <div class="card-body">
          {% if classrooms %}
          <div class="table-responsive">
            <table class="table table-hover">
              <thead class="table-light">
                <tr>
                  <th>#</th>
                  <th>Classroom Name</th>
                  <th>Total Students</th>
                  <th>Students List</th>
                  <th>Status</th>
                </tr>
              </thead>
              <tbody>
                {% for classroom in classrooms %}
                <tr>
                  <td>{{ loop.index }}</td>
                  <td>
                    <strong>{{ classroom.name }}</strong>
                  </td>
                  <td>
                    <span class="badge bg-primary"
                      >{{ classroom.kids | length }} students</span
                    >
                  </td>
                  <td>
                    {% if classroom.kids %}
                    <button
                      class="btn btn-sm btn-info"
                      type="button"
                      data-bs-toggle="collapse"
                      data-bs-target="#students-{{ classroom.id }}"
                    >
                      View Students ({{ classroom.kids | length }})
                    </button>
                    <div class="collapse mt-2" id="students-{{ classroom.id }}">
                      <div class="card card-body">
                        <ul class="list-group list-group-flush">
                          {% for kid in classroom.kids %}
                          <li
                            class="list-group-item d-flex justify-content-between align-items-center"
                          >
                            <div>
                              <strong>{{ kid.name }}</strong>
                              <br />
                              <small class="text-muted">
                                {{ kid.gender.value.title() }} | {{
                                kid.veg_preference.value.replace('_',
                                '-').title() }}
                              </small>
                            </div>
                            <div>
                              {% if kid.nutrition_reports %}
                              <span class="badge bg-success">Assessed</span>
                              {% else %}
                              <span class="badge bg-warning">Pending</span>
                              {% endif %}
                            </div>
                          </li>
                          {% endfor %}
                        </ul>
                      </div>
                    </div>
                    {% else %}
                    <span class="text-muted">No students yet</span>
                    {% endif %}
                  </td>
                  <td>
                    {% if classroom.kids | length > 0 %}
                    <span class="badge bg-success">Active</span>
                    {% else %}
                    <span class="badge bg-secondary">Empty</span>
                    {% endif %}
                  </td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>

          <!-- Summary Section -->
          <div class="row mt-4">
            <div class="col-md-6">
              <div class="card border-primary">
                <div class="card-header">
                  <h6 class="mb-0">📈 Student Distribution</h6>
                </div>
                <div class="card-body">
                  {% for classroom in classrooms %}
                  <div class="mb-2">
                    <div class="d-flex justify-content-between mb-1">
                      <span><strong>{{ classroom.name }}</strong></span>
                      <span>{{ classroom.kids | length }} students</span>
                    </div>
                    <div class="progress">
                      {% set classroom_percent = ((classroom.kids | length) /
                      total_kids * 100) if total_kids > 0 else 0 %}
                      <div
                        class="progress-bar bg-primary"
                        style="width: {{ classroom_percent | round }}%"
                      ></div>
                    </div>
                  </div>
                  {% endfor %}
                </div>
              </div>
            </div>

            <div class="col-md-6">
              <div class="card border-success">
                <div class="card-header">
                  <h6 class="mb-0">📊 Assessment Status</h6>
                </div>
                <div class="card-body">
                  <div class="mb-3">
                    <div class="d-flex justify-content-between mb-1">
                      <span><strong>Assessed</strong></span>
                      <span>{{ assessed_kids }} students</span>
                    </div>
                    <div class="progress">
                      {% set assessed_percent = (assessed_kids / total_kids *
                      100) if total_kids > 0 else 0 %}
                      <div
                        class="progress-bar bg-success"
                        style="width: {{ assessed_percent | round }}%"
                      ></div>
                    </div>
                  </div>
                  <div class="mb-3">
                    <div class="d-flex justify-content-between mb-1">
                      <span><strong>Pending</strong></span>
                      <span>{{ total_kids - assessed_kids }} students</span>
                    </div>
                    <div class="progress">
                      {% set pending_percent = ((total_kids - assessed_kids) /
                      total_kids * 100) if total_kids > 0 else 0 %}
                      <div
                        class="progress-bar bg-warning"
                        style="width: {{ pending_percent | round }}%"
                      ></div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          {% else %}
          <div class="alert alert-warning text-center">
            <h5>🏛️ No Classrooms Yet</h5>
            <p>
              You haven't created any classrooms yet. Start by creating your
              first classroom.
            </p>
            <a href="/authority/create-classroom" class="btn btn-success mt-2"
              >Create First Classroom</a
            >
          </div>
          {% endif %}
        </div>
      </div>
    </div>
  </div>

  <!-- Getting Started Guide (if no data) -->
  {% if not classrooms or total_kids == 0 %}
  <div class="row mt-4">
    <div class="col-12">
      <div class="card border-info">
        <div class="card-header bg-info text-white">
          <h5 class="mb-0">🚀 Getting Started</h5>
        </div>
        <div class="card-body">
          <h6>Follow these steps to set up your school:</h6>
          <ol>
            <li>
              <strong>Create Classrooms:</strong> Set up classrooms for
              different grades (e.g., Class 1A, Class 2B)
            </li>
            <li>
              <strong>Add Students:</strong> Register students with parent login
              credentials
            </li>
            <li>
              <strong>Conduct Assessments:</strong> Use the nutrition calculator
              to assess student health
            </li>
            <li>
              <strong>Monitor Progress:</strong> Track student health and share
              reports with parents
            </li>
          </ol>
        </div>
      </div>
    </div>
  </div>
  {% endif %}
</div>
{% endblock %}
